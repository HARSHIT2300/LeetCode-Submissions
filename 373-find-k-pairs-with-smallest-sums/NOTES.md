Quite an interesting and confusing problem
Involves tricky thinking but rather okayish implementation